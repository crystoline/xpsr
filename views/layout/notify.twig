
<div id="notify" data-enhance="false">
    <div id="notifyheader" class="ui-widget-header ui-corner-all">
        <?php print _('Notifications')?>
        <span id="notifyhide"> <span class="glyphicon glyphicon-eye-open" title="show"></span></span>
        <span id="notifyclear"> <span class="glyphicon glyphicon-trash" title="delete"> </span></span>
    </div>
    <div id="notifybody" style="background-color: #AB8899;height: 0; overflow: hidden">
        <div id="notifyinfo">
            Connecting ....
        </div>
    </div>
    <span id="sound"></span>
    <script>
        $(function() {
            //$("#notifyinfo").customScrollbar();

            var state = true;
            notifystate = state;
            $( "#notifyhide" ).click(function() {
                if ( state ) {
                    $(this).html('<span class="glyphicon glyphicon-eye-close" title="hide"></span>');
                    $( "#notifybody" ).animate({
                        height: 100,
                        backgroundColor: "#FC6",
                    }, 1000 );
                    $( "#notifybody" ).css({height: 'auto'});
                    $( "#notifyheader" ).animate({
                    }, 1000 );

                } else {
                    $(this).html('<span class="glyphicon glyphicon-eye-open"></span>');

                    $( "#notifybody" ).animate({
                        height: 0,
                        backgroundColor: "#AB8899",
                        //	borderColor: "#FFF"
                    }, 1000 );

                    $( "#notifyheader" ).animate({

                    }, 1000 );
                }
                state = !state;
            });



        });

        // @param filename The name of the file WITHOUT ending

        function playSound(filename){
            document.getElementById("sound").innerHTML='\
	<audio  autoplay="autoplay"> \
		<source src="/'+ filename + '.mp3" type="audio/mpeg" />\
		<source src="/' + filename + '.ogg" type="audio/ogg" />\
		<embed hidden="true" autostart="true" loop="false" \
		src="/' + filename +'.mp3" />\
	</audio>';
        }
        function getNotify(Data){
            $.ajax({
                url: {{ 'ajax/notify.php'|url }},
                data: Data,
                success: function(result,status,xhr){
                    $('#notifyinfo').html(result);
                },
                error: function(xhr,status,error){
                    $('#notifyinfo').html('Could not fetch notifications. Will attempt again');
                },
                beforeSend: function(xhr){
                    //('#notifyheader').progressbar({ value: false});
                }
            });
            //$('#notifybody').load('<?php url('/')?>ajax/notify.php',);
        }
        let curNotifyPage = window.location;
        $(function(){
            $("#notifyclear").click(function(){
                getNotify('page=<?php print $curnotifypage?>');//&clear=true');
            });
        });
        //setTimeout("getNotify('page='+curNotifyPage)",5000);
        setInterval("getNotify('page='+curNotifyPage)",30000);
    </script>
</div>
